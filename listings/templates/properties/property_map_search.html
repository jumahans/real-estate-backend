{% extends 'properties/base.html' %}
{% load static humanize %}

{% block title %}Map Search | ArthiProperties{% endblock %}

{% block extra_css %}
<style>
    /* Full height layout without footer interference */
    body { overflow-y: hidden; } 
    .map-container { height: calc(100vh - 80px); }
    .property-scroll { height: calc(100vh - 80px); overflow-y: auto; }
    
    /* Custom Scrollbar */
    .property-scroll::-webkit-scrollbar { width: 6px; }
    .property-scroll::-webkit-scrollbar-thumb { background-color: #ddd; border-radius: 4px; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <div class="row g-0">
        <div class="col-lg-4 col-xl-3 bg-light property-scroll border-end">
            <div class="p-3 border-bottom bg-white sticky-top">
                <h5 class="fw-bold mb-0 font-heading">
                    {{ properties.count }} Properties
                </h5>
                <small class="text-muted">Showing properties on map</small>
            </div>
            
            <div class="p-3">
                {% for property in properties %}
                <div class="card border-0 shadow-sm mb-3 rounded-3 overflow-hidden">
                    <div class="row g-0">
                        <div class="col-4">
                            {% if property.images.first %}
                                <img src="{{ property.images.first.image.url }}" class="h-100 w-100 object-fit-cover" alt="...">
                            {% else %}
                                <div class="bg-secondary h-100 w-100 d-flex align-items-center justify-content-center text-white"><i class="bi bi-image"></i></div>
                            {% endif %}
                        </div>
                        <div class="col-8">
                            <div class="card-body p-2">
                                <h6 class="card-title fw-bold text-truncate mb-1">{{ property.title }}</h6>
                                <p class="card-text text-primary fw-bold mb-1 small">{{ property.currency }} {{ property.price|intword }}</p>
                                <p class="card-text small text-muted text-truncate mb-0"><i class="bi bi-geo-alt"></i> {{ property.city }}</p>
                                <a href="{% url 'property_detail' property.pk %}" class="stretched-link"></a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="col-lg-8 col-xl-9 map-container position-relative bg-secondary bg-opacity-10">
            <div class="position-absolute top-50 start-50 translate-middle text-center">
                <div class="bg-white p-4 rounded-4 shadow-lg">
                    <i class="bi bi-map display-4 text-primary mb-3"></i>
                    <h3 class="fw-bold">Interactive Map</h3>
                    <p class="text-muted mb-3">Integrate Google Maps or Leaflet.js here.</p>
                    <button class="btn btn-outline-primary rounded-pill btn-sm">Load Map API</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}