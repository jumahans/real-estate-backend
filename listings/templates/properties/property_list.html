{% extends 'properties/base.html' %}
{% load static %}

{% block title %}Browse Properties{% endblock %}

{% block extra_css %}
<style>
    .hero-section {
        position: relative;
        background-image: url('https://images.unsplash.com/photo-1564013799919-ab600027ffc6?q=80&w=2070');
        background-size: cover;
        background-position: center;
        transition: all 0.3s ease;
        overflow: hidden;
    }
    
    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.4);
        z-index: 1;
        transition: transform 0.3s ease;
    }
    
    .hero-section:hover::before {
        transform: scale(1.05);
    }
    
    .hero-section > .container {
        position: relative;
        z-index: 2;
    }
    
    .hero-brand {
        font-size: 3rem;
        font-weight: 700;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        margin-bottom: 1rem;
        letter-spacing: 1px;
    }
    
    .hero-section h1 {
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .hero-section .lead {
        color: rgba(255, 255, 255, 0.95);
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }
    
    .search-box {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    
    .search-box .form-control,
    .search-box .form-select {
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .search-box .btn-primary {
        background-color: #10b981;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    
    .featured-scroll-section {
        padding: 60px 0;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        position: relative;
    }
    
    .featured-scroll-container {
        position: relative;
        overflow: hidden;
    }
    
    .featured-scroll-wrapper {
        display: flex;
        gap: 20px;
        overflow-x: auto;
        scroll-behavior: smooth;
        padding: 20px 0;
        scrollbar-width: thin;
        scrollbar-color: #10b981 #f1f1f1;
    }
    
    .featured-scroll-wrapper::-webkit-scrollbar {
        height: 8px;
    }
    
    .featured-scroll-wrapper::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    
    .featured-scroll-wrapper::-webkit-scrollbar-thumb {
        background: #10b981;
        border-radius: 10px;
    }
    
    .featured-scroll-wrapper::-webkit-scrollbar-thumb:hover {
        background: #059669;
    }
    
    .featured-property-card {
        min-width: 320px;
        max-width: 320px;
        flex-shrink: 0;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: none;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        background: white;
    }
    
    .featured-property-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    
    .featured-property-card img {
        height: 200px;
        object-fit: cover;
        width: 100%;
    }
    
    .scroll-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(16, 185, 129, 0.9);
        color: white;
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .featured-scroll-container:hover .scroll-arrow {
        opacity: 1;
    }
    
    .scroll-arrow:hover {
        background: rgba(5, 150, 105, 0.9);
        transform: translateY(-50%) scale(1.1);
    }
    
    .scroll-arrow.left {
        left: 10px;
    }
    
    .scroll-arrow.right {
        right: 10px;
    }
    
    .btn-outline-primary {
        border-color: #10b981;
        color: #10b981;
    }
    
    .btn-outline-primary:hover {
        background-color: #10b981;
        border-color: #10b981;
        color: white;
    }
    
    .btn-outline-primary.active {
        background-color: #10b981;
        border-color: #10b981;
        color: white;
    }
    
    .badge.bg-primary {
        background-color: #10b981 !important;
    }
    
    .page-link {
        color: #10b981;
    }
    
    .page-link:hover {
        color: #059669;
        background-color: rgba(16, 185, 129, 0.1);
    }
    
    .page-item.active .page-link {
        background-color: #10b981;
        border-color: #10b981;
    }
</style>
{% endblock %}

{% block extra_js %}
<style>
    .scroll-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(16, 185, 129, 0.9);
        color: white;
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const scrollWrapper = document.querySelector('.featured-scroll-wrapper');
    const leftArrow = document.querySelector('.scroll-arrow.left');
    const rightArrow = document.querySelector('.scroll-arrow.right');
    
    if (scrollWrapper && leftArrow && rightArrow) {
        leftArrow.addEventListener('click', function() {
            scrollWrapper.scrollBy({ left: -340, behavior: 'smooth' });
        });
        
        rightArrow.addEventListener('click', function() {
            scrollWrapper.scrollBy({ left: 340, behavior: 'smooth' });
        });
    }
});
</script>
{% endblock %}

{% block content %}

<section class="hero-section bg-light py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 mb-4 mb-lg-0">
                <h1 class="hero-brand">ArthiProperties</h1>
                <h1 class="display-4 fw-bold mb-3">Find Your Dream Property</h1>
                <p class="lead text-muted">Browse {{ total_count }} available properties</p>
            </div>
            <div class="col-lg-6">
                <div class="search-box">
                    <form method="get" action="{% url 'property_list' %}">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <input type="text" class="form-control" name="search" placeholder="Search by location, title..." value="{{ search_query }}">
                            </div>
                            <div class="col-md-6">
                                <select class="form-select" name="property_type">
                                    <option value="">All Types</option>
                                    {% for value, label in property_types %}
                                        <option value="{{ value }}" {% if request.GET.property_type == value %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-4">
                                <input type="number" class="form-control" name="min_price" placeholder="Min Price" value="{{ request.GET.min_price }}">
                            </div>
                            <div class="col-md-4">
                                <input type="number" class="form-control" name="max_price" placeholder="Max Price" value="{{ request.GET.max_price }}">
                            </div>
                            <div class="col-md-4">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="bi bi-search"></i> Search
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="filters-section py-3 bg-white border-bottom">
    <div class="container">
        <div class="d-flex flex-wrap gap-2 align-items-center">
            <span class="fw-bold me-2">Quick Filters:</span>
            {% for value, label in listing_types %}
                <a href="?listing_type={{ value }}" class="btn btn-sm btn-outline-primary {% if request.GET.listing_type == value %}active{% endif %}">
                    <i class="bi bi-tag"></i> {{ label }}
                </a>
            {% endfor %}
            <a href="?is_waterfront=true" class="btn btn-sm btn-outline-info {% if request.GET.is_waterfront == 'true' %}active{% endif %}">
                <i class="bi bi-water"></i> Waterfront
            </a>
            <a href="{% url 'property_list' %}" class="btn btn-sm btn-outline-danger">
                <i class="bi bi-x-circle"></i> Clear All
            </a>
        </div>
    </div>
</section>

<section class="featured-scroll-section">
    <div class="container">
        <h2 class="mb-4 fw-bold">Featured Properties</h2>
        <div class="featured-scroll-container">
            <button class="scroll-arrow left">←</button>
            <button class="scroll-arrow right">→</button>
            <div class="featured-scroll-wrapper">
                {% for property in properties|slice:":10" %}
                    <div class="card featured-property-card">
                        <div class="position-relative">
                            {% if property.images.all %}
                                {% with property.images.all.0 as first_image %}
                                    <img src="{{ first_image.image.url }}" class="card-img-top" alt="{{ property.title }}">
                                {% endwith %}
                            {% else %}
                                <img src="https://via.placeholder.com/320x200?text=No+Image" class="card-img-top" alt="No image">
                            {% endif %}
                            <span class="badge bg-primary position-absolute top-0 start-0 m-2">
                                {{ property.get_listing_type_display }}
                            </span>
                        </div>
                        <div class="card-body">
                            <h6 class="card-title">
                                <a href="{% url 'property_detail' property.pk %}" class="text-decoration-none text-dark">
                                    {{ property.title|truncatewords:6 }}
                                </a>
                            </h6>
                            <p class="property-price mb-2" style="font-size: 1.2rem;">
                                {{ property.currency }} {{ property.price|floatformat:0 }}
                            </p>
                            <p class="text-muted small mb-2">
                                <i class="bi bi-geo-alt"></i> {{ property.city }}, {{ property.state }}
                            </p>
                            <a href="{% url 'property_detail' property.pk %}" class="btn btn-sm btn-outline-primary w-100">
                                View Details
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<section class="properties-section py-5">
    <div class="container">
        <div class="row">
            
            <div class="col-lg-3 mb-4">
                <div class="filter-sidebar">
                    <h5 class="mb-4"><i class="bi bi-sliders"></i> Filters</h5>
                    <form method="get">
                        
                        <div class="mb-4">
                            <label class="form-label fw-bold">City</label>
                            <select class="form-select" name="city">
                                <option value="">All Cities</option>
                                {% for city in cities %}
                                    <option value="{{ city }}" {% if request.GET.city == city %}selected{% endif %}>{{ city }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold">Property Type</label>
                            <select class="form-select" name="property_type">
                                <option value="">All Types</option>
                                {% for value, label in property_types %}
                                    <option value="{{ value }}" {% if request.GET.property_type == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold">Listing Type</label>
                            <select class="form-select" name="listing_type">
                                <option value="">Any</option>
                                {% for value, label in listing_types %}
                                    <option value="{{ value }}" {% if request.GET.listing_type == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold">Price Range</label>
                            <div class="row g-2">
                                <div class="col-6">
                                    <input type="number" class="form-control form-control-sm" name="min_price" placeholder="Min" value="{{ request.GET.min_price }}">
                                </div>
                                <div class="col-6">
                                    <input type="number" class="form-control form-control-sm" name="max_price" placeholder="Max" value="{{ request.GET.max_price }}">
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold">Bedrooms</label>
                            <select class="form-select" name="min_bedrooms">
                                <option value="">Any</option>
                                <option value="1" {% if request.GET.min_bedrooms == '1' %}selected{% endif %}>1+</option>
                                <option value="2" {% if request.GET.min_bedrooms == '2' %}selected{% endif %}>2+</option>
                                <option value="3" {% if request.GET.min_bedrooms == '3' %}selected{% endif %}>3+</option>
                                <option value="4" {% if request.GET.min_bedrooms == '4' %}selected{% endif %}>4+</option>
                                <option value="5" {% if request.GET.min_bedrooms == '5' %}selected{% endif %}>5+</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold">Zoning</label>
                            <select class="form-select" name="zoning_type">
                                <option value="">Any</option>
                                {% for value, label in zoning_types %}
                                    <option value="{{ value }}" {% if request.GET.zoning_type == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_waterfront" value="true" id="waterfront" {% if request.GET.is_waterfront == 'true' %}checked{% endif %}>
                                <label class="form-check-label" for="waterfront">Waterfront</label>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold">Sort By</label>
                            <select class="form-select" name="sort">
                                <option value="-created_at" {% if request.GET.sort == '-created_at' or not request.GET.sort %}selected{% endif %}>Newest First</option>
                                <option value="created_at" {% if request.GET.sort == 'created_at' %}selected{% endif %}>Oldest First</option>
                                <option value="price" {% if request.GET.sort == 'price' %}selected{% endif %}>Price: Low to High</option>
                                <option value="-price" {% if request.GET.sort == '-price' %}selected{% endif %}>Price: High to Low</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mb-2">
                            <i class="bi bi-filter"></i> Apply Filters
                        </button>
                        <a href="{% url 'property_list' %}" class="btn btn-outline-secondary w-100">
                            <i class="bi bi-x"></i> Clear All
                        </a>
                    </form>
                </div>
            </div>

            <div class="col-lg-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">{{ total_count }} Properties Found</h4>
                    <a href="{% url 'property_search' %}" class="btn btn-outline-primary">
                        <i class="bi bi-search"></i> Advanced Search
                    </a>
                </div>

                {% if properties %}
                    <div class="row g-4">
                        {% for property in properties %}
                            <div class="col-md-6 col-lg-4">
                                <div class="card property-card h-100">
                                    <div class="position-relative">
                                        {% if property.images.all %}
                                            {% with property.images.all.0 as first_image %}
                                                <img src="{{ first_image.image.url }}" class="card-img-top" alt="{{ property.title }}" loading="lazy">
                                            {% endwith %}
                                        {% else %}
                                            <img src="https://via.placeholder.com/400x250?text=No+Image" class="card-img-top" alt="No image">
                                        {% endif %}
                                        
                                        {% if user.is_authenticated %}
                                            <form method="post" action="{% url 'property_favorite_toggle' property.pk %}" class="d-inline">
                                                {% csrf_token %}
                                                <button type="submit" class="favorite-btn">
                                                    <i class="bi bi-heart-fill"></i>
                                                </button>
                                            </form>
                                        {% endif %}

                                        <span class="badge bg-primary position-absolute top-0 start-0 m-2">
                                            {{ property.get_listing_type_display }}
                                        </span>
                                    </div>
                                    
                                    <div class="card-body">
                                        <h5 class="card-title">
                                            <a href="{% url 'property_detail' property.pk %}" class="text-decoration-none text-dark">
                                                {{ property.title|truncatewords:8 }}
                                            </a>
                                        </h5>
                                        
                                        <p class="property-price mb-2">
                                            {{ property.currency }} {{ property.price|floatformat:0 }}
                                        </p>
                                        
                                        <p class="text-muted small mb-3">
                                            <i class="bi bi-geo-alt"></i> {{ property.city }}, {{ property.state }}
                                        </p>
                                        
                                        <div class="d-flex gap-3 text-muted small">
                                            {% if not property.is_land %}
                                                {% if property.bedrooms %}
                                                    <span><i class="bi bi-door-closed"></i> {{ property.bedrooms }} Beds</span>
                                                {% endif %}
                                                {% if property.bathrooms %}
                                                    <span><i class="bi bi-droplet"></i> {{ property.bathrooms }} Baths</span>
                                                {% endif %}
                                                {% if property.area_sqft %}
                                                    <span><i class="bi bi-arrows-angle-expand"></i> {{ property.area_sqft|floatformat:0 }} sqft</span>
                                                {% endif %}
                                            {% else %}
                                                {% if property.land_size_acres %}
                                                    <span><i class="bi bi-geo"></i> {{ property.land_size_acres }} acres</span>
                                                {% endif %}
                                                {% if property.zoning_type %}
                                                    <span><i class="bi bi-file-text"></i> {{ property.get_zoning_type_display }}</span>
                                                {% endif %}
                                            {% endif %}
                                        </div>
                                        
                                        <div class="mt-3">
                                            <span class="badge badge-custom bg-light text-dark">{{ property.get_property_type_display }}</span>
                                            {% if property.is_waterfront %}
                                                <span class="badge badge-custom bg-info text-white">Waterfront</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <div class="card-footer bg-white border-top-0">
                                        <a href="{% url 'property_detail' property.pk %}" class="btn btn-outline-primary w-100">
                                            View Details <i class="bi bi-arrow-right"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    {% if properties.has_other_pages %}
                        <nav aria-label="Page navigation" class="mt-5">
                            <ul class="pagination justify-content-center">
                                {% if properties.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page=1{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                            <i class="bi bi-chevron-double-left"></i>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ properties.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                            <i class="bi bi-chevron-left"></i>
                                        </a>
                                    </li>
                                {% endif %}

                                <li class="page-item active">
                                    <span class="page-link">Page {{ properties.number }} of {{ properties.paginator.num_pages }}</span>
                                </li>

                                {% if properties.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ properties.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                            <i class="bi bi-chevron-right"></i>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ properties.paginator.num_pages }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                            <i class="bi bi-chevron-double-right"></i>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    {% endif %}

                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-search display-1 text-muted"></i>
                        <h3 class="mt-3">No Properties Found</h3>
                        <p class="text-muted">Try adjusting your filters or search criteria</p>
                        <a href="{% url 'property_list' %}" class="btn btn-primary mt-3">
                            <i class="bi bi-arrow-clockwise"></i> Reset Filters
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

{% endblock %}